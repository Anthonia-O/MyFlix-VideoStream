name: CI/CD Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  # Frontend Service Job
  frontend:
    name: 💻 Frontend - Build and Push Docker Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js for Frontend
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies for Frontend
        run: npm install
        working-directory: ./frontend

      - name: Build Docker image for Frontend
        run: docker build -t frontend ./frontend

  # API Gateway Job
  api-gateway:
    name: 🚪 API Gateway - Build and Push Docker Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js for API Gateway
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies for API Gateway
        run: npm install
        working-directory: ./api-gateway

      - name: Build Docker image for API Gateway
        run: docker build -t api-gateway ./api-gateway

  # Authentication Service Job
  authentication:
    name: 🔐 Authentication - Build and Push Docker Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js for Authentication
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies for Authentication
        run: npm install
        working-directory: ./backend/authentication

      - name: Build Docker image for Authentication
        run: docker build -t authentication ./backend/authentication

  # Billing Service Job
  billing:
    name: 💸 Billing - Build and Push Docker Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js for Billing
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies for Billing
        run: npm install
        working-directory: ./backend/billing

      - name: Build Docker image for Billing
        run: docker build -t billing ./backend/billing

  # Video Management Service Job
  video-management:
    name: 🎥 Video Management - Build and Push Docker Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js for Video Management
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies for Video Management
        run: npm install
        working-directory: ./backend/video-management

      - name: Build Docker image for Video Management
        run: docker build -t video-management ./backend/video-management

  # Watchlist Service Job
  watchlist:
    name: 📋 Watchlist - Build and Push Docker Image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Node.js for Watchlist
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies for Watchlist
        run: npm install
        working-directory: ./backend/watchlist

      - name: Build Docker image for Watchlist
        run: docker build -t watchlist ./backend/watchlist

